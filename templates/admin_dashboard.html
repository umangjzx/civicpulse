{% extends "base.html" %}

{% block title %}Admin Dashboard - CivicPulse{% endblock %}

{% block extra_css %}
<style>
    body {
        background: #f4f7fb;
    }

    h2, h5 {
        letter-spacing: -0.4px;
    }

    .card {
        border-radius: 18px;
        transition: all 0.3s ease;
    }

    .card:hover {
        transform: translateY(-4px);
        box-shadow: 0 18px 40px rgba(0,0,0,0.08);
    }

    /* Stat Cards */
    .stat-card {
        position: relative;
        overflow: hidden;
    }

    .stat-card::after {
        content: '';
        position: absolute;
        width: 120px;
        height: 120px;
        right: -40px;
        top: -40px;
        background: rgba(255,255,255,0.15);
        border-radius: 50%;
    }

    .stat-icon {
        opacity: 0.35;
    }

    /* Buttons */
    .btn {
        border-radius: 30px;
        padding: 10px 18px;
        transition: all 0.3s ease;
    }

    .btn-outline-primary:hover {
        background: linear-gradient(135deg, #0d6efd, #4dabf7);
        color: #fff;
        border-color: transparent;
    }

    .btn-outline-success:hover {
        background: linear-gradient(135deg, #198754, #20c997);
        color: #fff;
        border-color: transparent;
    }

    .btn-outline-info:hover {
        background: linear-gradient(135deg, #0dcaf0, #38d9a9);
        color: #fff;
        border-color: transparent;
    }

    .btn-outline-warning:hover {
        background: linear-gradient(135deg, #ffc107, #ff922b);
        color: #fff;
        border-color: transparent;
    }

    /* Table */
    table td {
        vertical-align: middle;
    }

    .badge {
        border-radius: 12px;
        padding: 0.45em 0.7em;
        font-size: 0.75rem;
    }
</style>
{% endblock %}

{% block content %}

<!-- HEADER -->
<div class="row mb-4 align-items-center">
    <div class="col">
        <h2 class="fw-bold mb-1">
            <i class="fas fa-tachometer-alt text-primary"></i> Admin Dashboard
        </h2>
        <p class="text-muted mb-0">
            Centralized administrative control & real-time system monitoring
        </p>
    </div>
</div>

<!-- STATS -->
<div class="row g-4 mb-4">

    <!-- Total Complaints -->
    <div class="col-md-3">
        <div class="card stat-card border-0 shadow-sm bg-primary text-white">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h6 class="mb-2">Total Complaints</h6>
                        <h2 class="mb-0 fw-bold" id="totalComplaints">--</h2>
                    </div>
                    <i class="fas fa-file-alt fa-3x stat-icon"></i>
                </div>
            </div>
        </div>
    </div>

    <!-- Resolved -->
    <div class="col-md-3">
        <div class="card stat-card border-0 shadow-sm bg-success text-white">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h6 class="mb-2">Resolved</h6>
                        <h2 class="mb-0 fw-bold" id="resolvedComplaints">--</h2>
                    </div>
                    <i class="fas fa-check-circle fa-3x stat-icon"></i>
                </div>
            </div>
        </div>
    </div>

    <!-- In Progress -->
    <div class="col-md-3">
        <div class="card stat-card border-0 shadow-sm bg-warning text-white">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h6 class="mb-2">In Progress</h6>
                        <h2 class="mb-0 fw-bold" id="inProgressComplaints">--</h2>
                    </div>
                    <i class="fas fa-spinner fa-3x stat-icon"></i>
                </div>
            </div>
        </div>
    </div>

    <!-- Pending -->
    <div class="col-md-3">
        <div class="card stat-card border-0 shadow-sm bg-info text-white">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h6 class="mb-2">Pending Review</h6>
                        <h2 class="mb-0 fw-bold" id="pendingComplaints">--</h2>
                    </div>
                    <i class="fas fa-exclamation-circle fa-3x stat-icon"></i>
                </div>
            </div>
        </div>
    </div>

</div>

<!-- ACTIONS + STATUS -->
<div class="row g-4">

    <!-- QUICK ACTIONS -->
    <div class="col-md-6">
        <div class="card border-0 shadow-sm h-100">
            <div class="card-body">
                <h5 class="fw-bold mb-3">
                    <i class="fas fa-bolt text-primary"></i> Quick Actions
                </h5>

                <div class="d-grid gap-3">
                    <a href="{{ url_for('admin_complaints') }}" class="btn btn-outline-primary">
                        <i class="fas fa-list"></i> View All Complaints
                    </a>

                    <a href="{{ url_for('admin_analytics') }}" class="btn btn-outline-success">
                        <i class="fas fa-chart-bar"></i> View Analytics
                    </a>

                    <a href="{{ url_for('admin_users') }}" class="btn btn-outline-info">
                        <i class="fas fa-users"></i> Manage Users
                    </a>

                    <a href="{{ url_for('admin_reports') }}" class="btn btn-outline-warning">
                        <i class="fas fa-file-pdf"></i> Generate Reports
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- SYSTEM STATUS -->
    <div class="col-md-6">
        <div class="card border-0 shadow-sm h-100">
            <div class="card-body">
                <h5 class="fw-bold mb-3">
                    <i class="fas fa-heartbeat text-danger"></i> System Status
                </h5>

                <table class="table table-borderless table-sm mb-0">
                    <tbody>
                        <tr>
                            <td>Database</td>
                            <td class="text-end">
                                <span class="badge bg-success">Online</span>
                            </td>
                        </tr>
                        <tr>
                            <td>AI Engine</td>
                            <td class="text-end">
                                <span class="badge bg-success">Active</span>
                            </td>
                        </tr>
                        <tr>
                            <td>API Server</td>
                            <td class="text-end">
                                <span class="badge bg-success">Running</span>
                            </td>
                        </tr>
                        <tr>
                            <td>Last Backup</td>
                            <td class="text-end">
                                <small class="text-muted">Today at 2:00 AM</small>
                            </td>
                        </tr>
                    </tbody>
                </table>

            </div>
        </div>
    </div>

</div>

<!-- STATS SCRIPT -->
<script>
async function loadStats() {
    try {
        const response = await fetch('/api/analytics/stats');
        const data = await response.json();

        document.getElementById('totalComplaints').textContent = data.total || 0;
        document.getElementById('resolvedComplaints').textContent = data.resolved || 0;
        document.getElementById('inProgressComplaints').textContent = data.inProgress || 0;
        document.getElementById('pendingComplaints').textContent = data.pending || 0;
    } catch (error) {
        console.error('Error loading stats:', error);
    }
}

// Load stats immediately on page load
document.addEventListener('DOMContentLoaded', loadStats);

// Auto-refresh stats every 5 seconds (5000ms)
setInterval(loadStats, 5000);
</script>

{% endblock %}
